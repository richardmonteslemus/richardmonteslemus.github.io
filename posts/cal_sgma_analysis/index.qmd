---
title: "Evaluating California's Sustainable Groundwater Management Act"
description: "Using segmented regression to analyze groundwater level trends before and after SGMA implementation"
author: "Richard Montes Lemus"
date: "2024-12-05"
categories: [water resources, policy analysis, R, regression]
image: "groundwater.png"
draft: false
---

[Link to Github Repository](https://github.com/richardmonteslemus/Cal_SGMA) This repository contains code, file structures, and references for the following California Sustainable Groundwater Management Act analysis.

# About

In 2014, California passed the Sustainable Groundwater Management Act (SGMA) aimed at addressing the over-exploitation of groundwater across California (Water Education Foundation, n.d.). The need for groundwater regulation was made urgent by the severe California drought of 2012-2016. This act required local and regional agencies to develop and implement sustainable groundwater management plans. High and medium-priority basins in critical overdraft were required to submit and begin implementing management plans by January 2020, while the rest had until January 2022 (Water Education Foundation, n.d.).

This analysis uses a segmented regression model to evaluate whether groundwater level trends changed after SGMA implementation. The analysis examines water surface elevations from January 2012 through November 2025 for monitoring wells across California operated by the California Department of Water Resources.

# Data limitation

The groundwater level data used in this analysis exhibits several features that affect the statistical analysis:

Seasonality: Groundwater levels fluctuate seasonally, increasing during wet seasons and decreasing during dry periods. This could make it difficult to distinguish seasonal groundwater water depletion from over drafting.

Autocorrelation not addressed: This analysis does not account for autocorrelation in the regression model. Groundwater levels depend on previous levels. This creates autocorrelation for our response variables. Therefore, groundwater level observations cannot be considered independent. This can affect the reliability of standard errors and significance tests.

Policy Intervention Variation: Not all wells were subject to the January 2020 SGMA Sustainable Groundwater Plan submission and implementation. Some wells had until January 2022 to start implementing their plan. Despite this, a single policy intervention date (January 2020) was used in order to make a single breakpoint for groundwater level observations over time.

# References

California Department of Water Resources. (November 1, 2025). Continuous Groundwater Level Measurements. California Natural Resources Agency Open Data Portal. Retrieved December 4, 2024, from https://data.cnra.ca.gov/dataset/continuous-groundwater-level-measurements

California Department of Water Resources. (November 1, 2025). Groundwater Sustainability Agencies. Retrieved December 4, 2024, from https://water.ca.gov/Programs/Groundwater-Management/SGMA-Groundwater-Management/Groundwater-Sustainable-Agencies

Water Education Foundation. (n.d.). Sustainable Groundwater Management Act (SGMA). Aquapedia. Retrieved December 4, 2024, from https://www.watereducation.org/aquapedia-background/sustainable-groundwater-management-act-sgma

```{r}
# Load in libraries
library(segmented)
library(tidyverse)
library(here)
library(lubridate)
```

```{r}
# Read in groundwater level data 
gw_level_month <- read_csv(here("posts", "cal_sgma_analysis", "data", "16f256f8-35a4-4cab-ae02-399a2914c282.csv"))

# Read in groundwater station metadata
station <- read_csv((here("posts", "cal_sgma_analysis", "data", "03967113-1556-4100-af2c-b16a4d41b9d0.csv")))
```

# Cleaning data

The following code is used to generate a final data frame with information about each well's water surface elevation and station metadata. It transforms the time column from a string type to a date type to facilitate exploratory analysis plotting. Lastly, it removes problematic well measurements based on quality codes. It only keeps rows with quality codes 1 (good data), 2 (Good quality edited data), 10 (Good measurement), 15 (Provisional measurement).

```{r}
# Join station and water level data 
station_gw <- left_join(gw_level_month, station, by = "STATION")
```

```{r}
# Turn time column into datetime type
station_gw <- station_gw %>% 
  mutate ("MSMT_DATE" = ymd(station_gw$MSMT_DATE)) %>% 
  filter(MSMT_DATE >= ymd("2012-01-01")) # Select  measurements from 2012 and on 
```

```{r}
# Final quality filtering
quality_codes_to_keep <- c(1, 2, 10, 15)
```

```{r}
# Return dataframe with high quality groundwater level measurements
station_gw_filtered <- station_gw %>%
  filter(WSE_QC %in% quality_codes_to_keep) %>%
  filter(!is.na(WSE))  # Remove missing water surface elevations
```

```{r}
# Plot water surface elevation over time
station_gw_filtered %>% 
ggplot(aes(x = MSMT_DATE, y = WSE)) + 
  geom_point() + 
  labs(
    title = "Observed Groundwater Levels in California",
    x = "Date",
    y = "Mean Water Surface Elevation (feet)",
    caption = "Points = observed monthly averages") +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 12, face = "bold"),
  )
```

The following code plots the observed groundwater water surface elevation. Visually it seems there is a significant increase in groundwater water surface elevation after 2020.

# Prepare data for segmented regression model

The following code calculates the monthly mean groundwater level across all wells and creates a time counter variable, a variable needed for the segmentation regression analysis. The counter starts at 0 for January 2012 and increases by 1 for each following month. The code also obtains the counter number for January 2020 (SGMA implementation), which will be used as an initial estimate for the breakpoint in the segmented regression model.

```{r}
# Calculate monthly average across all wells
station_month_avg <- station_gw_filtered %>%
  group_by(MSMT_DATE) %>%
  summarize(mean_WSE = mean(WSE, na.rm = TRUE),
            n_wells = n()) %>%
  ungroup() %>% 
  arrange(MSMT_DATE) %>% # arrange by date 
  mutate(Time = 0:(n()-1)) # Add monthly counter 

# Find monthly counter number for policy implementation date
jan_2020_time <- min(station_month_avg$Time[station_month_avg$MSMT_DATE >= ymd("2020-01-01")])
```

# Segmentation model

Fit a segmented regression model to the data.

```{r}
# Fit prerequisite linear model
initial_model <- lm(mean_WSE ~ Time, data = station_month_avg)

# Fit segmented regression
sgma_segmented <- segmented(initial_model, 
                            seg.Z = ~Time,
                            psi = jan_2020_time)  # Initial guess

summary(sgma_segmented)
```

# Interpret model results

A segmented regression model was fitted to monthly groundwater water surface elevation measurements from January 2012 - November 2024. The model found the breakpoint to be month 126.86 which corresponds to approximately September 2022. This is about 2.5 years later than the expected breakpoint of January 2020. While it is possible that this is due to the implementation of groundwater management plans taking a while to impact groundwater levels, it is more probable that this breakpoint is attributed to extreme weather events. Around September 2022, California experienced extreme precipitation events that replenished groundwater levels all over the state. Therefore, it is difficult to make a distinction between extreme precipitation helping and SGMA plans affecting groundater levels.

**Coefficients:**

Time: 0.3121 feet/month This coefficient corresponds to the pre-breakpoint slope. On average, before the breakpoint, groundwater levels increased by about 0.3121 feet per month. This positive slope is likely due to the 2012 - 2016 California drought causing a low initial groundwater level. It is statistically significant with a p value of 0.0101.

U1.Time: 11.7201 feet/month This coefficient corresponds to the post-breakpoint slope. On average, after the breakpoint, groundwater levels increased by about 11.7201 feet per month. This steep increase in slope is likely due to extreme precipitation events that occurred after the breakpoint. The model was unable to calculate a p value for this slope.

**Model Fit:** R\^2 = 0.8648

This model explains about 86.7% of the variability in groundwater levels during selected dates. This indicated a strong model fit.

**Breakpoint:** The model calculated the breakpoint to be month 126.86 which is approximately September 2022.

**Confidence Interval:** Time: 0.12 feet/month The standard error corresponds to the pre-breakpoint slope. We are 95% confident the slope is between 0.07 and 0.55 feet per month. Since zero is not included, we are confident groundwater levels were rising before the breakpoint.

U1.Time: 0.72 feet/month The standard error corresponds to the post-breakpoint slope. Since we did not receive a P value for this slope we are unable to make claims about the confidence in the slope range.

Breakpoint: 1.534 months The standard error corresponds to the breakpoint estimate. We are 95% confident the breakpoint falls between month 124 - 130 (July 2022 - November 2022).

# Generate predicitons

Create a grid of predictions to input into model

```{r}
# Create grid of predictions for entire time range 
pred_grid <- expand_grid(
  Time = seq(0, max(station_month_avg$Time), by = 1)  # Have every month from 0 to end 
)

# Generate predictions using model and grid
segmented_predictions <- pred_grid %>%
  mutate(
    predicted_WSE = predict(sgma_segmented, newdata = pred_grid),
    MSMT_DATE = min(station_month_avg$MSMT_DATE) + months(Time), # Add date 
    period = ifelse(Time < sgma_segmented$psi[2], "Pre-breakpoint", "Post-breakpoint") # Set pre and post breakpoint categories
  )

# Assign predicted breakpoint 
breakpoint_date <- ymd("2022-09-01")
```

# Plot predictions

```{r}
# Plot observed data and predicted segmented regression lines
ggplot() +
  geom_point(data = station_month_avg, 
             aes(x = MSMT_DATE, y = mean_WSE),
             alpha = 0.5, size = 2, color = "gray40") +
  # Plot predicted segmented regression line
  geom_line(data = segmented_predictions,
            aes(x = MSMT_DATE, y = predicted_WSE, color = period)) +
  # Vertical line at model breakpoint
  geom_vline(xintercept = breakpoint_date,
             linetype = "dashed", color = "red", size = 1) +
  # Vertical line at SGMA implementation
  geom_vline(xintercept = ymd("2020-01-01"),
             linetype = "dotted", color = "darkgreen", size = 1) +
  annotate("text", 
           x = breakpoint_date,
           y = 750,
           label = "Model-estimated\nbreakpoint\n(Sept 2022)",
           color = "red", hjust = -0.1, size = 2) +
  annotate("text",
           x = ymd("2020-01-01"),
           y = 200,
           label = "SGMA\nimplementation\n(Jan 2020)",
           color = "darkgreen", hjust = 1.1, size = 2) +
  scale_color_manual(values = c("Pre-breakpoint" = "cornflowerblue", 
                                  "Post-breakpoint" = "firebrick"),
                     name = "Time Period") +
  labs(
    title = "Segmented Regression Model: Observed vs. Predicted Groundwater Levels in California",
    x = "Date",
    y = "Mean Water Surface Elevation (feet)",
    caption = "Points = observed monthly averages; Lines = segmented regression predictions"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 11, face = "bold"),
    legend.position = "bottom"
  )
```

The following code plots the observed and predicted groundwater water surface elevation. Visually, it seems that the slopes predicted by the segmentation regression fit the observed data well.
